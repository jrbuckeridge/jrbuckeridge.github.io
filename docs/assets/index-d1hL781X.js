(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const c of h.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(i){if(i.ep)return;i.ep=!0;const h=e(i);fetch(i.href,h)}})();class o{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i}scaled(t){return new o(this.x*t,this.y*t,this.width*t,this.height*t)}collidesWith(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}}class l{constructor(t,e,s){this.width=t,this.height=e,this.scale=s||1}}const b=.5,B=.5;class y{constructor(t,e,s,i,h,c){this.player=t,this.id=e,this.numFrames=i,this.images=[];for(let m=1;m<=i;m++){const v=new Image,x=String(m).padStart(2,"0");v.src=s+x+".png",this.images.push(v)}this.size=h,this.size.scale=this.size.scale||1,this.resize(t.game.size),this.timeInState=0,this.hitBox=c}reset(){this.timeInState=0}getHitBox(){return this.hitBox}resize(t){this.size.scaledWidth=this.size.width*this.size.scale*this.player.game.ratio.yScale,this.size.scaledHeight=this.size.height*this.size.scale*this.player.game.ratio.yScale}handleControlsInput(t){}}class C extends y{constructor(t){super(t,"idle","img/hero-girl/Golden_Kunoichi_Idle_",8,new l(200,300),new o(50,50,100,225))}handleInput(t){if(!t.released)switch(t.key){case"ArrowUp":this.player.tryJump();break;case"ArrowDown":this.player.tryCrouch();break;case"ArrowRight":this.player.tryRun();break;case" ":this.player.tryAttack();break}}handleControlsInput(t){super.handleControlsInput(t),t.right()&&!t.down()&&this.player.tryRun(),t.up()?this.player.tryJump():t.down()&&this.player.tryCrouch(),t.isAttack()&&this.player.tryAttack()}update(t){this.timeInState+=t*.5,this.player.speedY=0,this.player.speedX>0?this.player.speedX-=b:this.player.x>this.player.initialXPosition&&(this.player.x-=t/2)}}class A extends y{constructor(t){super(t,"jump","img/hero-girl/Golden_Kunoichi_Jump_",14,new l(250,300),new o(50,50,150,150)),this.allowedTimeInState=2*233.31}handleInput(t){}handleControlsInput(t){super.handleControlsInput(t)}update(t){this.timeInState+=t*.75,this.timeInState<this.allowedTimeInState/2||this.timeInState>=this.allowedTimeInState/2&&this.timeInState<this.allowedTimeInState||(this.player.speedY=0,this.player.tryIdle())}}class D extends y{constructor(t){super(t,"run","img/hero-girl/Golden_Kunoichi_Run_",8,new l(250,300),new o(50,50,150,225))}handleInput(t){if(!t.released){switch(t.key){case"ArrowUp":this.player.tryJump();break;case" ":this.player.tryAttack();break}return}switch(t.key){case"ArrowRight":this.player.tryIdle();break}}handleControlsInput(t){super.handleControlsInput(t),t.right()&&!t.down()&&this.player.tryRun(),t.up()?this.player.tryJump():t.down()&&this.player.tryCrouch(),t.isAttack()&&this.player.tryAttack(),t.idle()&&this.player.tryIdle()}update(t){this.timeInState+=t,this.player.speedY=0,this.player.speedX<B&&(this.player.speedX+=b)}}class M extends y{constructor(t){super(t,"attack","img/hero-girl/Golden_Kunoichi_Attack_",17,new l(500,350),new o(200,50,250,250)),this.sounds=[],["sounds/swish-9.wav","sounds/swish-10.wav"].forEach(s=>{const i=new Audio;i.src=s,this.sounds.push(i)})}reset(){super.reset(),this.sounds[0].play()}handleInput(t){}handleControlsInput(t){super.handleControlsInput(t)}update(t){this.timeInState+=t,this.player.speedX=0,this.player.speedY=0,this.timeInState>=566&&this.player.tryIdle()}}class T extends y{constructor(t){super(t,"hurt","img/hero-girl/Golden_Kunoichi_Hurt_",3,new l(200,300),new o(0,0,0,0)),this.sounds=[],["sounds/blub_hurt.wav"].forEach(s=>{const i=new Audio;i.src=s,this.sounds.push(i)})}reset(){super.reset(),this.sounds[0].play()}handleInput(t){}handleControlsInput(t){super.handleControlsInput(t)}update(t){this.timeInState+=t,this.player.speedX=0,this.player.speedY=0,this.timeInState>=400&&this.player.tryIdle()}}class _ extends y{constructor(t){super(t,"faint","img/hero-girl/Golden_Kunoichi_Faint_",14,new l(250,300),new o(0,0,0,0)),this.sounds=[],["sounds/blub_hurt.wav"].forEach(s=>{const i=new Audio;i.src=s,this.sounds.push(i)})}reset(){super.reset(),this.sounds[0].play()}handleInput(t){}handleControlsInput(t){super.handleControlsInput(t)}update(t){this.timeInState+=t*.25,this.player.speedX=0,this.player.speedY=0,this.timeInState>=450&&(this.player.gameOver=!0)}}class V extends y{constructor(t){super(t,"crouch","img/hero-girl/Golden_Kunoichi_Crouch_",2,new l(200,300),new o(50,125,100,100))}handleInput(t){if(t.released)switch(t.key){case"ArrowDown":this.player.tryIdle();break}}handleControlsInput(t){super.handleControlsInput(t),(!t.down()||t.idle())&&this.player.tryIdle()}update(t){this.timeInState+=t*.1,this.player.speedX=0,this.player.speedY=0}}const S=100;class O{constructor(t){this.game=t,this.states={},this.states.idle=new C(this),this.states.jump=new A(this),this.states.run=new D(this),this.states.attack=new M(this),this.states.crouch=new V(this),this.states.faint=new _(this),this.states.hurt=new T(this),this.state=this.states.idle,this.initialXPosition=this.game.size.width*.25-this.state.size.width/2,this.x=this.initialXPosition,this.y=this.game.size.height-this.state.size.height*this.game.ratio.yScale,this.speedX=0,this.speedY=0,this.life=S,this.gameOver=!1}resize(t){for(let e in this.states)this.states[e].resize(t);this.groundHero()}draw(t,e){const s=Math.floor(this.state.timeInState/33.33)%this.state.images.length;t.drawImage(this.state.images[s],0,0,this.state.size.width,this.state.size.height,this.x,this.y,this.state.size.scaledWidth,this.state.size.scaledHeight)}update(t){if(this.gameOver)return;this.state.update(t),this.x+=this.speedX*t;const e=this.game.size.width-this.state.size.scaledWidth;this.x>e&&(this.x=e),this.y+=this.speedY*t,this.y<this.game.size.height*.2?this.y=this.game.size.height*.2:this.y>this.game.size.height-this.state.size.scaledHeight&&(this.y=this.game.size.height-this.state.size.scaledHeight)}handleInput(t){this.state.handleInput(t)}handleControlsInput(t){this.state.handleControlsInput(t)}tryJump(){this.setState("jump"),this.speedY=-2.5}tryIdle(){this.setState("idle"),this.speedX=0}tryRun(){this.setState("run"),this.speedX=.5}tryAttack(){this.setState("attack")}tryGetHit(){this.state.id!=="hurt"&&(this.life-=15,this.life<0&&(this.life=0),this.isDefeated()?this.setState("faint"):this.setState("hurt"))}tryCrouch(){this.setState("crouch"),this.speedX=0}isAttacking(){return this.state===this.states.attack}setState(t){this.state=this.states[t],this.state.reset(),this.groundHero()}groundHero(){this.y=this.game.size.height-this.state.size.scaledHeight}getHitBox(){let t=this.state.getHitBox().scaled(this.game.ratio.yScale);return new o(this.x+t.x,this.y+this.speedY+t.y,t.width,t.height)}increaseLife(t){this.life+=t,this.life>S&&(this.life=S)}isDefeated(){return this.life<=0}}class g{constructor(t,e,s,i){this.image=new Image,this.image.src=t,this.x=0,this.xScale=s,this.width=e.width,this.height=e.height,this.gameSize=i,this.aspectRatio=this.width/this.height}resize(t,e){this.gameSize=t}computedWidth(){return this.gameSize.height*this.aspectRatio}update(t){this.x-=t*this.xScale,(this.x>=this.width||this.x<=-this.width)&&(this.x=this.x%this.width)}draw(t,e){let s=Math.floor((this.width-this.x)*this.aspectRatio);t.drawImage(this.image,this.x,0,this.width-this.x,this.height,0,0,s,this.gameSize.height),s<this.gameSize.width&&t.drawImage(this.image,0,0,this.width,this.height,s,0,s+Math.floor(this.width*this.aspectRatio),this.gameSize.height)}}class k{constructor(t,e){this.gameWidth=t.width,this.gameHeight=t.height,this.oscillatingFactor=1+Math.random(),this.oscillatingScalePercent=Math.random()*.05,this.yOffsetPercent=Math.random()<.5?75:50,this.states={},this.width=1261,this.height=747,this.scale=.1,this.states.flying=new X(this,"img/villains/"+e+"/skeleton-flying_",10),this.states.defeated=new R(this,"img/villains/"+e+"/skeleton-defeated_",20),this.state=this.states.flying,this.x=this.gameWidth*1.1,this.y=this.gameHeight*.65,this.disabled=!1,this.defeated=!1,this.scoreValue=80+Math.floor(Math.random()*20)}setPosition(t,e){this.x=t,this.y=e}resize(t,e){this.gameWidth=t.width,this.gameHeight=t.height}draw(t,e){if(this.disabled)return;const s=Math.floor(this.state.timeInState/33.33)%this.state.images.length;t.drawImage(this.state.images[s],0,0,this.width,this.height,this.x,this.y,this.width*this.scale,this.height*this.scale)}update(t){this.disabled||this.state.update(t)}tryDefeated(){this.state=this.states.defeated,this.state.reset(),this.defeated=!0}getHitBox(){return new o(this.x+30,this.y,(this.width-500)*this.scale,(this.height-250)*this.scale)}}let G=class{constructor(t,e,s){this.villain=t,this.images=[];for(let i=1;i<=s;i++){const h=new Image;h.src=e+i+".png",this.images.push(h)}this.timeInState=0}reset(){this.timeInState=0}update(t){this.timeInState+=t}};class X extends G{constructor(t,e,s){super(t,e,s)}update(t){super.update(t),this.villain.x-=t*.15;const e=this.villain.oscillatingScalePercent*this.villain.gameHeight/100;this.villain.y=e*Math.sin(this.villain.oscillatingFactor*this.timeInState/100)+this.villain.yOffsetPercent*this.villain.gameHeight/100}}class R extends G{constructor(t,e,s){super(t,e,s)}update(t){super.update(t),this.timeInState>20*33.33&&(this.villain.disabled=!0)}}class E{constructor(t,e,s,i){this.gameWidth=t,this.gameHeight=e,this.states={},this.size=s,this.states.moving=new F(this,i),this.state=this.states.moving,this.x=this.gameWidth*1.1,this.yOffsetPercent=55+(Math.random()-.5)*30,this.y=this.gameHeight*this.yOffsetPercent/100,this.disabled=!1,this.scoreValue=0,this.lifeValue=0}setPosition(t,e){this.x=t,this.y=e}resize(t,e){this.gameWidth=t.width,this.gameHeight=t.height,this.y=this.gameHeight*this.yOffsetPercent/100}draw(t,e){if(this.disabled)return;const s=Math.floor(this.state.timeInState/33.33)%this.state.images.length;t.drawImage(this.state.images[s],0,0,this.size.width,this.size.height,this.x,this.y,this.size.width*this.size.scale,this.size.height*this.size.scale)}update(t){this.disabled||this.state.update(t)}tryCapture(){this.disabled=!0}getHitBox(){return new o(this.x,this.y,this.size.width*this.size.scale,this.size.height*this.size.scale)}}const W=new Audio("sounds/coin1.wav");class I extends E{constructor(t){super(t.width,t.height,new l(266,268,.2),{imagePrefix:"img/coins/gold-coins/frame-",numStates:8}),this.scoreValue=20+Math.floor(Math.random()*20),this.lifeValue=15}tryCapture(){super.tryCapture(),W.play()}}class U extends E{constructor(t){super(t.width,t.height,new l(299,297,.15),{imagePrefix:"img/health/red-health/frame-",numStates:6}),this.scoreValue=0,this.lifeValue=15}}class K{constructor(t,e){this.powerUp=t,this.images=[];for(let s=1;s<=e.numStates;s++){const i=new Image;i.src=e.imagePrefix+s+".png",this.images.push(i)}this.timeInState=0}reset(){this.timeInState=0}update(t){this.timeInState+=t}}class F extends K{constructor(t,e){super(t,e)}update(t){super.update(t),this.powerUp.x-=t*.2}}const r=new l(61,75),a=new l(75,61),p=new l(80,80);function w(n){const t=new Image;return t.src=n,t}const Y=w("./img/controller/up-dark.png"),$=w("./img/controller/up-transparent.png"),J=w("./img/controller/down-dark.png"),N=w("./img/controller/down-transparent.png"),q=w("./img/controller/left-dark.png"),j=w("./img/controller/left-transparent.png"),Z=w("./img/controller/right-dark.png"),Q=w("./img/controller/right-transparent.png"),tt=w("./img/controller/attack-dark.png"),et=w("./img/controller/attack-transparent.png");class it{constructor(){this.horizontal=0,this.vertical=0,this.attack=!1}right(){return this.horizontal>0}left(){return this.horizontal<0}up(){return this.vertical<0}down(){return this.vertical>0}isAttack(){return this.attack}idle(){return this.horizontal===0&&this.vertical===0&&!this.attack}}class st{constructor(t,e,s){this.controls=new it,this.directionsPosition=e,this.actionsPosition=s,this.directionPointerId=void 0,this.attackPointerId=void 0,this.directionHitBoxes=void 0,this.attackHitBox=void 0,this.ratio=t.game.ratio,this.initControlHitBoxes(),this.keyDownEventListener=i=>{switch(i.key){case"ArrowUp":this.controls.vertical=-1;break;case"ArrowDown":this.controls.vertical=1;break;case"ArrowLeft":this.controls.horizontal=-1;break;case"ArrowRight":this.controls.horizontal=1;break;case" ":this.controls.attack=!0;break}t.handleInput({key:i.key,released:!1})},this.keyUpEventListener=i=>{switch(i.key){case"ArrowUp":this.controls.vertical<0&&(this.controls.vertical=0);break;case"ArrowDown":this.controls.vertical>0&&(this.controls.vertical=0);break;case"ArrowLeft":this.controls.horizontal<0&&(this.controls.horizontal=0);break;case"ArrowRight":this.controls.horizontal>0&&(this.controls.horizontal=0);break;case" ":this.controls.attack=!1;break}t.handleInput({key:i.key,released:!0})},this.touchStartEventListener=i=>{i.preventDefault();for(const h of i.changedTouches){const c=new o(h.pageX-h.radiusX/2,h.pageY-h.radiusY/2,h.radiusX,h.radiusY);this.directionPointerId===void 0&&(this.directionHitBoxes.up.collidesWith(c)?(this.directionPointerId=h.identifier,this.controls.vertical=-1):this.directionHitBoxes.down.collidesWith(c)&&(this.directionPointerId=h.identifier,this.controls.vertical=1),this.directionHitBoxes.left.collidesWith(c)?(this.directionPointerId=h.identifier,this.controls.horizontal=-1):this.directionHitBoxes.right.collidesWith(c)&&(this.directionPointerId=h.identifier,this.controls.horizontal=1)),this.attackPointerId===void 0&&this.attackHitBox.collidesWith(c)&&(this.attackPointerId=h.identifier,this.controls.attack=!0)}t.handleControlsInput(this.controls)},this.touchEndEventListener=i=>{i.preventDefault();for(const h of i.changedTouches)this.directionPointerId!==void 0&&this.directionPointerId===h.identifier&&(this.directionPointerId=void 0,this.controls.horizontal=0,this.controls.vertical=0),this.attackPointerId!==void 0&&this.attackPointerId===h.identifier&&(this.attackPointerId=void 0,this.controls.attack=!1);t.handleControlsInput(this.controls)},this.touchCancelEventListener=i=>{i.preventDefault();for(const h of i.changedTouches)this.directionPointerId!==void 0&&this.directionPointerId===h.identifier&&(this.directionPointerId=void 0,this.controls.horizontal=0,this.controls.vertical=0),this.attackPointerId!==void 0&&this.attackPointerId===h.identifier&&(this.attackPointerId=void 0,this.controls.attack=!1);t.handleControlsInput(this.controls)}}registerListeners(){window.addEventListener("keydown",this.keyDownEventListener,{passive:!1}),window.addEventListener("keyup",this.keyUpEventListener,{passive:!1}),window.addEventListener("touchstart",this.touchStartEventListener,{passive:!1}),window.addEventListener("touchend",this.touchEndEventListener,{passive:!1}),window.addEventListener("touchcancel",this.touchCancelEventListener,{passive:!1}),window.addEventListener("touchmove",t=>{t.preventDefault()},{passive:!1})}unregisterListeners(){window.removeEventListener("keydown",this.keyDownEventListener),window.removeEventListener("keyup",this.keyUpEventListener),window.removeEventListener("touchstart",this.touchStartEventListener),window.removeEventListener("touchend",this.touchEndEventListener),window.removeEventListener("touchcancel",this.touchCancelEventListener)}initControlHitBoxes(){this.directionHitBoxes={};const t=r.height*.6*this.ratio.yScale,e=a.width*.6*this.ratio.yScale;this.directionHitBoxes.up=new o(this.directionsPosition.x-a.width*this.ratio.yScale,this.directionsPosition.y-r.height*this.ratio.yScale-t,a.width*2*this.ratio.yScale,t*2),this.directionHitBoxes.down=new o(this.directionsPosition.x-a.width*this.ratio.yScale,this.directionsPosition.y+r.height*.4*this.ratio.yScale,a.width*2*this.ratio.yScale,t*2),this.directionHitBoxes.left=new o(this.directionsPosition.x-a.width*this.ratio.yScale-e,this.directionsPosition.y-r.height*this.ratio.yScale,e*2,r.height*2*this.ratio.yScale),this.directionHitBoxes.right=new o(this.directionsPosition.x+a.width*.4*this.ratio.yScale,this.directionsPosition.y-r.height*this.ratio.yScale,e*2,r.height*2*this.ratio.yScale),this.attackHitBox=new o(this.actionsPosition.x-p.width,this.actionsPosition.y-p.height/2,p.width,p.height)}resize(t,e){this.ratio=e,this.directionsPosition.x=Math.floor(t.width*this.directionsPosition.xPercent/100),this.directionsPosition.y=Math.floor(t.height*this.directionsPosition.yPercent/100),this.actionsPosition.x=Math.floor(t.width*this.actionsPosition.xPercent/100),this.actionsPosition.y=Math.floor(t.height*this.actionsPosition.yPercent/100),this.initControlHitBoxes()}draw(t,e){const s=this.controls.vertical<0?$:Y,i=this.controls.vertical>0?N:J,h=this.controls.horizontal<0?j:q,c=this.controls.horizontal>0?Q:Z,m=this.controls.attack?et:tt;t.drawImage(s,0,0,r.width,r.height,this.directionsPosition.x-r.width/2*this.ratio.yScale,this.directionsPosition.y-r.height*this.ratio.yScale,r.width*this.ratio.yScale,r.height*this.ratio.yScale),t.drawImage(i,0,0,r.width,r.height,this.directionsPosition.x-r.width/2*this.ratio.yScale,this.directionsPosition.y,r.width*this.ratio.yScale,r.height*this.ratio.yScale),t.drawImage(h,0,0,a.width,a.height,this.directionsPosition.x-a.width*this.ratio.yScale,this.directionsPosition.y-a.height/2*this.ratio.yScale,a.width*this.ratio.yScale,a.height*this.ratio.yScale),t.drawImage(c,0,0,a.width,a.height,this.directionsPosition.x,this.directionsPosition.y-a.height/2*this.ratio.yScale,a.width*this.ratio.yScale,a.height*this.ratio.yScale),t.drawImage(m,0,0,p.width,p.height,this.actionsPosition.x-p.width*this.ratio.yScale,this.actionsPosition.y-p.height/2*this.ratio.yScale,p.width*this.ratio.yScale,p.height*this.ratio.yScale)}debugDraw(t,e){t.strokeRect(e.x,e.y,e.width,e.height)}update(){}}class ht{constructor(t,e,s,i,h){this.game=t,this.context=t.context,this.levelDetails=e,this.backgrounds=s,this.hero=i,this.goals=h,this.controller=new st(i,{x:t.size.width*.1,y:t.size.height*.9,xPercent:10,yPercent:90},{x:t.size.width*.9,y:t.size.height*.95,xPercent:95,yPercent:90}),this.controller.registerListeners(),this.villains=[],this.coins=[],this.powerUps=[],this.targetGoal=h,this.resize(this.game.size,this.game.ratio)}isLevelCompleted(){return this.targetGoal.isAchieved(this.game.score)}start(t){this.targetGoal=this.goals.add(t)}resize(t,e){const s=Math.floor(20*e.xScale);this.context.font=`${s}px Bungee`,this.hero.resize(t,e),this.controller.resize(t,e)}}class L{constructor(t){this.levelNumber=t}}function nt(n,t,e,s){let i=[];const h=new l(2048,1536);return i.push(new g("img/background/nature-landscape/layer-1.png",h,0,n.size)),i.push(new g("img/background/nature-landscape/layer-2.png",h,-.05,n.size)),i.push(new g("img/background/nature-landscape/layer-3.png",h,-.1,n.size)),i.push(new g("img/background/nature-landscape/layer-4.png",h,-.15,n.size)),i.push(new g("img/background/nature-landscape/layer-5.png",h,-.25,n.size)),i.push(new g("img/background/nature-landscape/layer-6.png",h,-.25,n.size)),i.push(new g("img/background/nature-landscape/layer-7.png",h,-.5,n.size)),new H(n,t,i,e,s)}function rt(n,t,e,s){let i=[];const h=new l(5e3,1290);return i.push(new g("img/background/snow/layer-1.png",h,-.025,n.size)),i.push(new g("img/background/snow/layer-2.png",h,-.1,n.size)),i.push(new g("img/background/snow/layer-3.png",h,-.15,n.size)),i.push(new g("img/background/snow/layer-4.png",h,-.35,n.size)),new H(n,t,i,e,s)}class H extends ht{constructor(t,e,s,i,h){super(t,e,s,i,h),this.timeSinceDefeated=0,this.gameOverListenersSet=!1,this.renderGoals=!0,this.timeSinceRenderGoals=0,this.renderGoalsKeyListener=d=>{d.preventDefault(),window.fullscreenEnabled||t.canvas.requestFullscreen(),!(this.timeSinceRenderGoals<2e3)&&(this.renderGoals=!1,window.removeEventListener("keypress",this.renderGoalsKeyListener),window.removeEventListener("touchstart",this.renderGoalsTouchListener))},this.renderGoalsTouchListener=d=>{d.preventDefault(),window.fullscreenEnabled||t.canvas.requestFullscreen(),!(this.timeSinceRenderGoals<2e3)&&(this.renderGoals=!1,window.removeEventListener("keypress",this.renderGoalsKeyListener),window.removeEventListener("touchstart",this.renderGoalsTouchListener))},window.addEventListener("keypress",this.renderGoalsKeyListener,{passive:!1}),window.addEventListener("touchstart",this.renderGoalsTouchListener,{passive:!1});const c=50,m=["bat01","bat02","bat03"];for(let d=1;d<=c;d++){let f=new k(t.size,m[Math.floor(Math.random()*100%m.length)]);f.setPosition(t.size.width*1.1+this.game.size.width*.5*d+(Math.random()-.5)*50,this.game.size.height/2+(Math.random()-.5)*200),this.villains.push(f)}const v=100;for(let d=1;d<=v;d++){let f=new I(this.game.size);f.setPosition(this.game.size.width*1.1+this.game.size.width*.25*d+(Math.random()-.5)*50,f.y),this.coins.push(f)}const x=Math.floor(c/15);for(let d=1;d<=x;d++){let f=new U(this.game.size);f.setPosition(this.villains[d*15-1].x+(Math.random()-.5)*50,this.game.size.height/2),this.powerUps.push(f)}}resize(t,e){super.resize(t,e);for(let s of this.backgrounds)s.resize(t,e);for(let s of this.villains)s.resize(t,e),s.setPosition(s.x,this.game.size.height*.5);for(let s of this.coins)s.resize(t,e);for(let s of this.powerUps)s.resize(t,e)}renderLevelGoals(t,e){this.timeSinceRenderGoals+=e,this.backgrounds[0].draw(t,e),this.context.save(),this.context.textAlign="center",this.context.fillText(`Level ${this.levelDetails.levelNumber}`,this.game.size.width*.5,this.game.size.height*.3),this.context.fillText(`Collect ${this.goals.coins} coins`,this.game.size.width*.5,this.game.size.height*.4);const s=new I(this.game.size);if(s.setPosition(this.game.size.width*.325,this.game.size.height*.39-36),s.draw(t,0),this.goals.defeatedVillains>0){this.context.fillText(`Defeat ${this.goals.defeatedVillains} villains`,this.game.size.width*.5,this.game.size.height*.5);const i=new k(this.game.size,"bat01");i.setPosition(this.game.size.width*.285,this.game.size.height*.5),i.draw(t,0)}this.timeSinceRenderGoals>1500&&this.context.fillText("Press anywhere to continue...",this.game.size.width*.5,this.game.size.height*.7),this.context.restore()}draw(t,e){if(this.renderGoals){this.renderLevelGoals(t,e);return}for(let s of this.backgrounds)s.draw(this.context,e);for(let s of this.villains)s.draw(this.context,e);for(let s of this.coins)s.draw(this.context,e);for(let s of this.powerUps)s.draw(this.context,e);this.hero.draw(this.context,e),this.controller.draw(t,e)}update(t){if(!this.renderGoals){if(this.isLevelCompleted()){this.game.levelCompleted(this);return}for(let e of this.backgrounds)e.update(t);for(let e of this.villains)e.update(t);for(let e of this.coins)e.update(t);for(let e of this.powerUps)e.update(t);if(this.hero.update(t),this.context.fillText(`Score: ${this.game.score.points}`,this.game.size.width*.025,this.game.size.height*.1),this.context.fillText(`Coins: ${this.game.score.coins}`,this.game.size.width*.025,this.game.size.height*.15),this.context.fillText(`Villains: ${this.game.score.defeatedVillains}`,this.game.size.width*.025,this.game.size.height*.2),this.context.fillText(`Life: ${this.hero.life}`,this.game.size.width*.025,this.game.size.height*.25),this.context.fillText(`Sound: ${this.game.soundOn?"On":"Off"}`,this.game.size.width*.025,this.game.size.height*.3),this.hero.isDefeated())this.timeSinceDefeated+=t;else{for(let e of this.villains){if(e.defeated||e.disabled)continue;const s=this.hero.getHitBox(),i=e.getHitBox();s.collidesWith(i)&&(this.hero.isAttacking()?(e.tryDefeated(),this.game.score.defeatedVillain(e)):this.hero.tryGetHit())}for(let e of this.coins){if(e.disabled||this.hero.isAttacking())continue;const s=this.hero.getHitBox(),i=e.getHitBox();s.collidesWith(i)&&(e.tryCapture(),this.game.score.addPoints(e.scoreValue),this.game.score.addCoins(1))}for(let e of this.powerUps){if(e.disabled||this.hero.isAttacking())continue;const s=this.hero.getHitBox(),i=e.getHitBox();s.collidesWith(i)&&(e.tryCapture(),this.game.score.addPoints(e.scoreValue),this.hero.increaseLife(e.lifeValue))}}this.hero.gameOver&&(this.context.save(),this.game.context.textAlign="center",this.context.fillText("Game Over.",this.game.size.width*.5,this.game.size.height*.4),this.timeSinceDefeated>2e3&&(this.context.fillText("Press anywhere to continue....",this.game.size.width*.5,this.game.size.height*.45),this.gameOverListenersSet||(this.gameOverListenersSet=!0,this.renderGoalsKeyListener=e=>{e.preventDefault(),window.removeEventListener("keypress",this.renderGoalsKeyListener),window.removeEventListener("touchstart",this.renderGoalsTouchListener),this.game.restart()},this.renderGoalsTouchListener=e=>{e.preventDefault(),window.removeEventListener("keypress",this.renderGoalsKeyListener),window.removeEventListener("touchstart",this.renderGoalsTouchListener),this.game.restart()},window.addEventListener("keypress",this.renderGoalsKeyListener,{passive:!1}),window.addEventListener("touchstart",this.renderGoalsTouchListener,{passive:!1}))),this.context.restore())}}}class u{constructor(t,e,s){this.coins=t,this.defeatedVillains=e,this.timeInMillis=s}add(t){return new u(this.coins+t.coins,this.defeatedVillains+t.defeatedVillains,this.timeInMillis)}isAchieved(t){return!(this.coins&&t.coins<this.coins||this.defeatedVillains&&t.defeatedVillains<this.defeatedVillains)}}class at{constructor(){this.points=0,this.coins=0,this.defeatedVillains=0}addPoints(t){this.points+=t,this.points<0&&(this.points=0)}addCoins(t){this.coins+=t,this.coins<0&&(this.coins=0)}defeatedVillain(t){this.points+=t.scoreValue,this.defeatedVillains++}}const P=new l(1180,820,1);class ot{constructor(t){this.xScale=t.width/P.width,this.yScale=t.height/P.height}}window.onload=function(){new z().start()};class z{constructor(){this.canvas=document.getElementById("canvas"),this.context=this.canvas.getContext("2d"),this.resize(new l(window.innerWidth,window.innerHeight)),this.soundOn=!1,this.currentLevel=void 0,this.score=new at,this.allGoals=[],this.currentGoalIndex=0,window.addEventListener("resize",t=>{this.resize(new l(t.currentTarget.innerWidth,t.currentTarget.innerHeight))})}resize(t){t.width<t.height?this.size=new l(t.height,t.width):this.size=t,this.ratio=new ot(this.size),this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.canvas.fontFamily="Bungee",this.currentLevel&&this.currentLevel.resize(this.size,this.ratio)}start(){let t=new Audio("sounds/Fun-Background.mp3");t.loop=!0,window.addEventListener("keypress",s=>{s.key==="s"&&(this.soundOn=!this.soundOn,this.soundOn?t.play():t.pause())}),this.hero=new O(this),this.allGoals.push(new u(10)),this.allGoals.push(new u(20,5)),this.allGoals.push(new u(35,10)),this.allGoals.push(new u(50,20)),this.allGoals.push(new u(60,30)),this.allGoals.push(new u(30,5)),this.allGoals.push(new u(35,10)),this.allGoals.push(new u(50,20)),this.allGoals.push(new u(60,30)),this.currentLevel=this.getCurrentLevel();let e=new Date().getTime();this.splashScreen=!0,this.registerSplashScreenListeners=!0,this.gameLoop=(function(){this.context.clearRect(0,0,this.size.width,this.size.height);const s=new Date().getTime(),i=s-e;e=s,this.splashScreen?this.renderSplashScreen():(this.currentLevel.draw(this.context,i),this.currentLevel.update(i)),requestAnimationFrame(this.gameLoop)}).bind(this),this.gameLoop()}getCurrentLevel(){return this.currentGoalIndex%2===0?nt(this,new L(this.currentGoalIndex+1),this.hero,this.allGoals[this.currentGoalIndex]):rt(this,new L(this.currentGoalIndex+1),this.hero,this.allGoals[this.currentGoalIndex])}levelCompleted(t){this.currentGoalIndex++,this.currentLevel=this.getCurrentLevel(),this.currentLevel.start(this.score)}renderSplashScreen(){this.registerSplashScreenListeners&&(this.renderGoalsKeyListener=e=>{e.preventDefault(),window.fullscreenEnabled||this.canvas.requestFullscreen(),this.splashScreen=!1,window.removeEventListener("keypress",this.renderGoalsKeyListener),window.removeEventListener("touchstart",this.renderGoalsTouchListener)},this.renderGoalsTouchListener=e=>{e.preventDefault(),window.fullscreenEnabled||this.canvas.requestFullscreen(),this.splashScreen=!1,window.removeEventListener("keypress",this.renderGoalsKeyListener),window.removeEventListener("touchstart",this.renderGoalsTouchListener)},window.addEventListener("keypress",this.renderGoalsKeyListener,{passive:!1}),window.addEventListener("touchstart",this.renderGoalsTouchListener,{passive:!1}),this.registerSplashScreenListeners=!1);for(let e of this.currentLevel.backgrounds)e.draw(this.context,0);this.context.save(),this.context.textAlign="center",this.context.font="48px Bungee",this.context.fillText("Kids Rush",this.canvas.width*.5,this.canvas.height*.3);const t=this.hero.states.attack.images[13];this.context.drawImage(t,0,0,t.width,t.height,this.canvas.width*.1,this.canvas.height*.3,500*.5,350*.5),this.context.font="20px Bungee",this.context.fillText("Touch anywhere (or press any key) to continue...",this.canvas.width*.5,this.canvas.height*.85),this.context.restore()}restart(){new z().start()}}
